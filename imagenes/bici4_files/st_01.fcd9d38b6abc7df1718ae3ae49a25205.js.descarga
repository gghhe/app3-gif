!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof noAMDDefine&&noAMDDefine.amd?noAMDDefine(["exports"],e):e(t.Overpass={})}(this,function(t){"use strict";function createCommonjsModule(t,e){return e={exports:{}},t(e,e.exports),e.exports}function __awaiter(t,e,n,r){return new(n||(n=Promise))(function(o,i){function step(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}},function rejected(t){try{step(r.throw(t))}catch(t){i(t)}})}step((r=r.apply(t,e||[])).next())})}function __generator(t,e){function verb(i){return function(c){return function step(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i}function listenOnePostMessage(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,new Promise(function(n){var r=new RegExp(e,"gi"),o=function(e){r.test(e.data)&&(t.removeEventListener("message",o),n(e))};t.addEventListener("message",o)})]})})}var e=createCommonjsModule(function(t,e){function isObject(t){return!!t&&("object"==(void 0===t?"undefined":n(t))||"function"==typeof t)}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},r=function(){var t=null,e=function(e,n){if(!isObject(e)||!isObject(n))throw new TypeError("Cannot create proxy with a non-object as target or handler");var r=function(){};t=function(){r=function(t){throw new TypeError("Cannot perform '"+t+"' on a proxy that has been revoked")}};var o=n;n={get:null,set:null,apply:null,construct:null};for(var i in o){if(!(i in n))throw new TypeError("Proxy polyfill does not support trap '"+i+"'");n[i]=o[i]}"function"==typeof o&&(n.apply=o.apply.bind(o));var s=this,c=!1,a="function"==typeof e;(n.apply||n.construct||a)&&(s=function(){var t=this&&this.constructor===s;if(r(t?"construct":"apply"),t&&n.construct)return n.construct.call(this,e,arguments);if(!t&&n.apply)return n.apply(e,this,arguments);if(a){if(t){var o=Array.prototype.slice.call(arguments);o.unshift(e);return new(e.bind.apply(e,o))}return e.apply(this,arguments)}throw new TypeError(t?"not a constructor":"not a function")},c=!0);var u=n.get?function(t){return r("get"),n.get(this,t,s)}:function(t){return r("get"),this[t]},f=n.set?function(t,e){r("set"),n.set(this,t,e,s)}:function(t,e){r("set"),this[t]=e},l={};Object.getOwnPropertyNames(e).forEach(function(t){if(!(c&&t in s)){var n={enumerable:!!Object.getOwnPropertyDescriptor(e,t).enumerable,get:u.bind(e,t),set:f.bind(e,t)};Object.defineProperty(s,t,n),l[t]=!0}});var p=!0;if(Object.setPrototypeOf?Object.setPrototypeOf(s,Object.getPrototypeOf(e)):s.__proto__?s.__proto__=e.__proto__:p=!1,n.get||!p)for(var h in e)l[h]||Object.defineProperty(s,h,{get:u.bind(e,h)});return Object.seal(e),Object.seal(s),s};return e.revocable=function(n,r){return{proxy:new e(n,r),revoke:t}},e}();"object"===n(e)?t.exports=Proxy||r:window&&!window.Proxy&&(window.Proxy=r)}),n={}.toString,r=function(t){return n.call(t).slice(8,-1)},o=createCommonjsModule(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),i=o["__core-js_shared__"]||(o["__core-js_shared__"]={}),s=function(t){return i[t]||(i[t]={})},c=0,a=Math.random(),u=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++c+a).toString(36))},f=createCommonjsModule(function(t){var e=s("wks"),n=o.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:u)("Symbol."+t))}).store=e}),l=f("toStringTag"),p="Arguments"==r(function(){return arguments}()),h=function(t){var e,n,o;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),l))?n:p?r(e):"Object"==(o=r(e))&&"function"==typeof e.callee?"Arguments":o},d=function(t){return"object"==typeof t?null!==t:"function"==typeof t},v=function(t){if(!d(t))throw TypeError(t+" is not an object!");return t},y=function(t){try{return!!t()}catch(t){return!0}},m=!y(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),w=o.document,b=d(w)&&d(w.createElement),g=function(t){return b?w.createElement(t):{}},_=!m&&!y(function(){return 7!=Object.defineProperty(g("div"),"a",{get:function(){return 7}}).a}),S=Object.defineProperty,O={f:m?Object.defineProperty:function defineProperty(t,e,n){if(v(t),e=function(t,e){if(!d(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!d(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!d(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!d(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(e,!0),v(n),_)try{return S(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},x=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},M=m?function(t,e,n){return O.f(t,e,x(1,n))}:function(t,e,n){return t[e]=n,t},j={}.hasOwnProperty,E=function(t,e){return j.call(t,e)},P=createCommonjsModule(function(t){var e=t.exports={version:"2.5.1"};"number"==typeof __e&&(__e=e)}),C=createCommonjsModule(function(t){var e=u("src"),n=Function.toString,r=(""+n).split("toString");P.inspectSource=function(t){return n.call(t)},(t.exports=function(t,n,i,s){var c="function"==typeof i;c&&(E(i,"name")||M(i,"name",n)),t[n]!==i&&(c&&(E(i,e)||M(i,e,t[n]?""+t[n]:r.join(String(n)))),t===o?t[n]=i:s?t[n]?t[n]=i:M(t,n,i):(delete t[n],M(t,n,i)))})(Function.prototype,"toString",function toString(){return"function"==typeof this&&this[e]||n.call(this)})}),T={};T[f("toStringTag")]="z",T+""!="[object z]"&&C(Object.prototype,"toString",function toString(){return"[object "+h(this)+"]"},!0);var L=Math.ceil,k=Math.floor,N=function(t){return isNaN(t=+t)?0:(t>0?k:L)(t)},F=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},A=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},I=function(t,e,n){if(A(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}},R=function(t,e,n){var r,i,s,c,a=t&R.F,u=t&R.G,f=t&R.S,l=t&R.P,p=t&R.B,h=u?o:f?o[e]||(o[e]={}):(o[e]||{}).prototype,d=u?P:P[e]||(P[e]={}),v=d.prototype||(d.prototype={});u&&(n=e);for(r in n)s=((i=!a&&h&&void 0!==h[r])?h:n)[r],c=p&&i?I(s,o):l&&"function"==typeof s?I(Function.call,s):s,h&&C(h,r,s,t&R.U),d[r]!=s&&M(d,r,c),l&&v[r]!=s&&(v[r]=s)};o.core=P,R.F=1,R.G=2,R.S=4,R.P=8,R.B=16,R.W=32,R.U=64,R.R=128;var z=R,D={},G=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)},q=function(t){return G(F(t))},B=Math.min,V=function(t){return t>0?B(N(t),9007199254740991):0},W=Math.max,U=Math.min,H=s("keys"),$=function(t){return H[t]||(H[t]=u(t))},J=function(t){return function(e,n,r){var o,i=q(e),s=V(i.length),c=function(t,e){return(t=N(t))<0?W(t+e,0):U(t,e)}(r,s);if(t&&n!=n){for(;s>c;)if((o=i[c++])!=o)return!0}else for(;s>c;c++)if((t||c in i)&&i[c]===n)return t||c||0;return!t&&-1}}(!1),K=$("IE_PROTO"),Q="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),X=Object.keys||function keys(t){return function(t,e){var n,r=q(t),o=0,i=[];for(n in r)n!=K&&E(r,n)&&i.push(n);for(;e.length>o;)E(r,n=e[o++])&&(~J(i,n)||i.push(n));return i}(t,Q)},Y=m?Object.defineProperties:function defineProperties(t,e){v(t);for(var n,r=X(e),o=r.length,i=0;o>i;)O.f(t,n=r[i++],e[n]);return t},Z=o.document,tt=Z&&Z.documentElement,et=$("IE_PROTO"),nt=function(){},rt=function(){var t,e=g("iframe"),n=Q.length;for(e.style.display="none",tt.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),rt=t.F;n--;)delete rt.prototype[Q[n]];return rt()},ot=Object.create||function create(t,e){var n;return null!==t?(nt.prototype=v(t),n=new nt,nt.prototype=null,n[et]=t):n=rt(),void 0===e?n:Y(n,e)},it=O.f,st=f("toStringTag"),ct=function(t,e,n){t&&!E(t=n?t:t.prototype,st)&&it(t,st,{configurable:!0,value:e})},at={};M(at,f("iterator"),function(){return this});var ut=function(t,e,n){t.prototype=ot(at,{next:x(1,n)}),ct(t,e+" Iterator")},ft=$("IE_PROTO"),lt=Object.prototype,pt=Object.getPrototypeOf||function(t){return t=function(t){return Object(F(t))}(t),E(t,ft)?t[ft]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?lt:null},ht=f("iterator"),dt=!([].keys&&"next"in[].keys()),vt=function(){return this},yt=function(t,e,n,r,o,i,s){ut(n,e,r);var c,a,u,f=function(t){if(!dt&&t in d)return d[t];switch(t){case"keys":return function keys(){return new n(this,t)};case"values":return function values(){return new n(this,t)}}return function entries(){return new n(this,t)}},l=e+" Iterator",p="values"==o,h=!1,d=t.prototype,v=d[ht]||d["@@iterator"]||o&&d[o],y=v||f(o),m=o?p?f("entries"):y:void 0,w="Array"==e?d.entries||v:v;if(w&&(u=pt(w.call(new t)))!==Object.prototype&&u.next&&(ct(u,l,!0),E(u,ht)||M(u,ht,vt)),p&&v&&"values"!==v.name&&(h=!0,y=function values(){return v.call(this)}),(dt||h||!d[ht])&&M(d,ht,y),D[e]=y,D[l]=vt,o)if(c={values:p?y:f("values"),keys:i?y:f("keys"),entries:m},s)for(a in c)a in d||C(d,a,c[a]);else z(z.P+z.F*(dt||h),e,c);return c},mt=function(t){return function(e,n){var r,o,i=String(F(e)),s=N(n),c=i.length;return s<0||s>=c?t?"":void 0:(r=i.charCodeAt(s))<55296||r>56319||s+1===c||(o=i.charCodeAt(s+1))<56320||o>57343?t?i.charAt(s):r:t?i.slice(s,s+2):o-56320+(r-55296<<10)+65536}}(!0);yt(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=mt(e,n),this._i+=t.length,{value:t,done:!1})});var wt=f("unscopables"),bt=Array.prototype;void 0==bt[wt]&&M(bt,wt,{});var gt=function(t){bt[wt][t]=!0},_t=function(t,e){return{value:e,done:!!t}},St=yt(Array,"Array",function(t,e){this._t=q(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,_t(1)):"keys"==e?_t(0,n):"values"==e?_t(0,t[n]):_t(0,[n,t[n]])},"values");D.Arguments=D.Array,gt("keys"),gt("values"),gt("entries");for(var Ot=f("iterator"),xt=f("toStringTag"),Mt=D.Array,jt={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Et=X(jt),Pt=0;Pt<Et.length;Pt++){var Ct,Tt=Et[Pt],Lt=jt[Tt],kt=o[Tt],Nt=kt&&kt.prototype;if(Nt&&(Nt[Ot]||M(Nt,Ot,Mt),Nt[xt]||M(Nt,xt,Tt),D[Tt]=Mt,Lt))for(Ct in St)Nt[Ct]||C(Nt,Ct,St[Ct],!0)}var Ft,At,It,Rt=f("iterator"),zt=Array.prototype,Dt=f("iterator"),Gt=P.getIteratorMethod=function(t){if(void 0!=t)return t[Dt]||t["@@iterator"]||D[h(t)]},qt=createCommonjsModule(function(t){var e={},n={},r=t.exports=function(t,r,o,i,s){var c,a,u,f,l=s?function(){return t}:Gt(t),p=I(o,i,r?2:1),h=0;if("function"!=typeof l)throw TypeError(t+" is not iterable!");if(function(t){return void 0!==t&&(D.Array===t||zt[Rt]===t)}(l)){for(c=V(t.length);c>h;h++)if((f=r?p(v(a=t[h])[0],a[1]):p(t[h]))===e||f===n)return f}else for(u=l.call(t);!(a=u.next()).done;)if((f=function(t,e,n,r){try{return r?e(v(n)[0],n[1]):e(n)}catch(e){var o=t.return;throw void 0!==o&&v(o.call(t)),e}}(u,p,a.value,r))===e||f===n)return f};r.BREAK=e,r.RETURN=n}),Bt=f("species"),Vt=o.process,Wt=o.setImmediate,Ut=o.clearImmediate,Ht=o.MessageChannel,$t=o.Dispatch,Jt=0,Kt={},Qt=function(){var t=+this;if(Kt.hasOwnProperty(t)){var e=Kt[t];delete Kt[t],e()}},Xt=function(t){Qt.call(t.data)};Wt&&Ut||(Wt=function setImmediate(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return Kt[++Jt]=function(){!function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}t.apply(n,e)}("function"==typeof t?t:Function(t),e)},Ft(Jt),Jt},Ut=function clearImmediate(t){delete Kt[t]},"process"==r(Vt)?Ft=function(t){Vt.nextTick(I(Qt,t,1))}:$t&&$t.now?Ft=function(t){$t.now(I(Qt,t,1))}:Ht?(It=(At=new Ht).port2,At.port1.onmessage=Xt,Ft=I(It.postMessage,It,1)):o.addEventListener&&"function"==typeof postMessage&&!o.importScripts?(Ft=function(t){o.postMessage(t+"","*")},o.addEventListener("message",Xt,!1)):Ft="onreadystatechange"in g("script")?function(t){tt.appendChild(g("script")).onreadystatechange=function(){tt.removeChild(this),Qt.call(t)}}:function(t){setTimeout(I(Qt,t,1),0)});var Yt={set:Wt,clear:Ut},Zt=Yt.set,te=o.MutationObserver||o.WebKitMutationObserver,ee=o.process,ne=o.Promise,re="process"==r(ee),oe={f:function(t){return new function PromiseCapability(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r}),this.resolve=A(e),this.reject=A(n)}(t)}},ie=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},se=f("species"),ce=f("iterator"),ae=!1;try{[7][ce]().return=function(){ae=!0}}catch(t){}var ue,fe,le,pe,he=Yt.set,de=function(){var t,e,n,r=function(){var r,o;for(re&&(r=ee.domain)&&r.exit();t;){o=t.fn,t=t.next;try{o()}catch(r){throw t?n():e=void 0,r}}e=void 0,r&&r.enter()};if(re)n=function(){ee.nextTick(r)};else if(te){var i=!0,s=document.createTextNode("");new te(r).observe(s,{characterData:!0}),n=function(){s.data=i=!i}}else if(ne&&ne.resolve){var c=ne.resolve();n=function(){c.then(r)}}else n=function(){Zt.call(o,r)};return function(r){var o={fn:r,next:void 0};e&&(e.next=o),t||(t=o,n()),e=o}}(),ve=o.TypeError,ye=o.process,me=o.Promise,we="process"==h(ye),be=function(){},ge=fe=oe.f,_e=!!function(){try{var t=me.resolve(1),e=(t.constructor={})[f("species")]=function(t){t(be,be)};return(we||"function"==typeof PromiseRejectionEvent)&&t.then(be)instanceof e}catch(t){}}(),Se=function(t){var e;return!(!d(t)||"function"!=typeof(e=t.then))&&e},Oe=function(t,e){if(!t._n){t._n=!0;var n=t._c;de(function(){for(var r=t._v,o=1==t._s,i=0;n.length>i;)!function(e){var n,i,s=o?e.ok:e.fail,c=e.resolve,a=e.reject,u=e.domain;try{s?(o||(2==t._h&&je(t),t._h=1),!0===s?n=r:(u&&u.enter(),n=s(r),u&&u.exit()),n===e.promise?a(ve("Promise-chain cycle")):(i=Se(n))?i.call(n,c,a):c(n)):a(r)}catch(t){a(t)}}(n[i++]);t._c=[],t._n=!1,e&&!t._h&&xe(t)})}},xe=function(t){he.call(o,function(){var e,n,r,i=t._v,s=Me(t);if(s&&(e=ie(function(){we?ye.emit("unhandledRejection",i,t):(n=o.onunhandledrejection)?n({promise:t,reason:i}):(r=o.console)&&r.error&&r.error("Unhandled promise rejection",i)}),t._h=we||Me(t)?2:1),t._a=void 0,s&&e.e)throw e.v})},Me=function(t){if(1==t._h)return!1;for(var e,n=t._a||t._c,r=0;n.length>r;)if((e=n[r++]).fail||!Me(e.promise))return!1;return!0},je=function(t){he.call(o,function(){var e;we?ye.emit("rejectionHandled",t):(e=o.onrejectionhandled)&&e({promise:t,reason:t._v})})},Ee=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),Oe(e,!0))},Pe=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw ve("Promise can't be resolved itself");(e=Se(t))?de(function(){var r={_w:n,_d:!1};try{e.call(t,I(Pe,r,1),I(Ee,r,1))}catch(t){Ee.call(r,t)}}):(n._v=t,n._s=1,Oe(n,!1))}catch(t){Ee.call({_w:n,_d:!1},t)}}};_e||(me=function Promise(t){!function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!")}(this,me,"Promise","_h"),A(t),ue.call(this);try{t(I(Pe,this,1),I(Ee,this,1))}catch(t){Ee.call(this,t)}},(ue=function Promise(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=function(t,e,n){for(var r in e)C(t,r,e[r],n);return t}(me.prototype,{then:function then(t,e){var n=ge(function(t,e){var n,r=v(t).constructor;return void 0===r||void 0==(n=v(r)[Bt])?e:A(n)}(this,me));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=we?ye.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&Oe(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),le=function(){var t=new ue;this.promise=t,this.resolve=I(Pe,t,1),this.reject=I(Ee,t,1)},oe.f=ge=function(t){return t===me||t===pe?new le(t):fe(t)}),z(z.G+z.W+z.F*!_e,{Promise:me}),ct(me,"Promise"),function(t){var e=o[t];m&&e&&!e[se]&&O.f(e,se,{configurable:!0,get:function(){return this}})}("Promise"),pe=P.Promise,z(z.S+z.F*!_e,"Promise",{reject:function reject(t){var e=ge(this);return(0,e.reject)(t),e.promise}}),z(z.S+z.F*!_e,"Promise",{resolve:function resolve(t){return function(t,e){if(v(t),d(e)&&e.constructor===t)return e;var n=oe.f(t);return(0,n.resolve)(e),n.promise}(this,t)}}),z(z.S+z.F*!(_e&&function(t,e){if(!e&&!ae)return!1;var n=!1;try{var r=[7],o=r[ce]();o.next=function(){return{done:n=!0}},r[ce]=function(){return o},t(r)}catch(t){}return n}(function(t){me.all(t).catch(be)})),"Promise",{all:function all(t){var e=this,n=ge(e),r=n.resolve,o=n.reject,i=ie(function(){var n=[],i=0,s=1;qt(t,!1,function(t){var c=i++,a=!1;n.push(void 0),s++,e.resolve(t).then(function(t){a||(a=!0,n[c]=t,--s||r(n))},o)}),--s||r(n)});return i.e&&o(i.v),n.promise},race:function race(t){var e=this,n=ge(e),r=n.reject,o=ie(function(){qt(t,!1,function(t){e.resolve(t).then(n.resolve,r)})});return o.e&&r(o.v),n.promise}});var Ce=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},Te=function(){function Map(){this.entries=[]}return Map.prototype.forEach=function(t){for(var e=0,n=0,r=this.entries;n<r.length;n++){var o=r[n];t(o[1],o[0],e),e++}},Map.prototype.get=function(t){return this.entries[this.indexOf(t)][1]},Map.prototype.has=function(t){return this.indexOf(t)>-1},Map.prototype.set=function(t,e){var n=this.indexOf(t);n>-1?(this.entries.slice(0,n),this.entries.push([t,e])):this.entries.push([t,e])},Map.prototype.indexOf=function(t){for(var e=0,n=0,r=this.entries;n<r.length;n++){if(t===r[n][0])return e;e++}return-1},Map}(),Le={serialize:function(t,e,n,r,o){void 0===o&&(o=[]);var i=function(t){try{return JSON.stringify(t)}catch(e){throw Error("OverpassSerialization: Error serializing \n "+t)}},s=o instanceof Error?"Error("+btoa(i({message:o.message,stack:o.stack}))+")":"Body("+btoa(i(o))+")";return["Overpass:"+i(t)+":"+i(e)+":"+i(n)+":"+i(r),s]},deserialize:function(t){var e=function(e){try{return JSON.parse(e)}catch(n){throw console.error(e),Error("OverpassSerialization: Error deserializing \n "+t)}},n=/Overpass:(.*):(.*):(.*):(.*):(.*)/.exec(t),r=(n[0],n[1]),o=n[2],i=n[3],s=n[4],c=n[5],a=/(Body|Error)\((.*)\)/.exec(c),u=(a[0],a[1]),f=a[2],l=e(atob(f));return"Error"===u&&Object.setPrototypeOf(l,Error.prototype),{uuid:e(r),isRequest:e(o),isError:"Error"===u,className:e(i),method:e(s),args:l}}},ke=function(){function OverpassConnection(t,e){this.uid=t,this.window=e}return OverpassConnection.prototype.createProxy=function(t,e){var n=this,r={};if(e)for(var o=0,i=e;o<i.length;o++){r[i[o]]=null}else Proxy.toString().indexOf("Cannot create proxy with a non-object as target or handler")>-1&&console.error("Be careful, you're not defining overpass proxy properties, and window.Proxy object is not native.");return new Proxy(r,{get:function(e,r){var o=this;return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(o,void 0,void 0,function(){var o,i,s,c;return __generator(this,function(a){switch(a.label){case 0:o=Le.serialize(n.uid,!0,t,r.toString(),e),n.window.postMessage(o.join(":"),"*"),i=o[0],a.label=1;case 1:return[4,listenOnePostMessage(window,i.replace("true","false"))];case 2:if(s=a.sent(),(c=Le.deserialize(s.data)).uuid===n.uid){if(c.isError)throw c.args;return[2,c.args]}return[3,1];case 3:return[2]}})})}}})},OverpassConnection.prototype.is=function(t){return this.window===t},OverpassConnection}(),Ne=window,Fe=function(){function OverpassClient(t){void 0===t&&(t=Ne),this.window=t,this.instances={},this.providers={}}return OverpassClient.prototype.open=function(t){var e=this;return void 0===t&&(t=200),new Promise(function(n,r){return __awaiter(e,void 0,void 0,function(){var e,o=this;return __generator(this,function(i){switch(i.label){case 0:return[4,new Promise(function(t){"completed"===document.readyState?t():document.addEventListener("DOMContentLoaded",t)})];case 1:return i.sent(),setTimeout(function(){return r(new Error("Cannot connect to Overpass server"))},t),this.sendRecurrentMessage("passport:connection:request"),[4,listenOnePostMessage(this.window,"passport:connection:response")];case 2:return e=i.sent(),this.connectionIdentifier=e.data.replace("passport:connection:response:",""),this.targetWindow=e.source,e.source.postMessage(e.data,"*"),this.window.addEventListener("message",function(t){if(t.data&&t.data.indexOf){if(t.data.indexOf("registered:"+o.connectionIdentifier)>-1){var e=new ke(o.connectionIdentifier,o.targetWindow);return n(e)}t.data.indexOf("Overpass")>-1&&o.handleMessage(t)}}),[2]}})})})},OverpassClient.prototype.getInstance=function(t){if(!this.instances[t.name])try{this.instances[t.name]=new this.providers[t.name]}catch(e){throw Error(t.name+" is not defined in OverpassClient.")}return this.instances[t.name]},OverpassClient.prototype.use=function(t){this.providers[t.name]=t},OverpassClient.prototype.handleMessage=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,r,o;return __generator(this,function(i){switch(i.label){case 0:if(!(e=Le.deserialize(t.data)).isRequest)return[2];if(!this.providers[e.className])throw Error("No "+e.className+" is defined in OverpassServer.");this.instances[e.className]=this.instances[e.className]||new this.providers[e.className],n=this.instances[e.className],i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n[e.method].apply(n,e.args)];case 2:return r=i.sent(),[3,4];case 3:return o=i.sent(),r=o,[3,4];case 4:return t.source.postMessage(Le.serialize(this.connectionIdentifier,!1,e.className,e.method,r).join(":"),"*"),[2]}})})},OverpassClient.prototype.sendRecurrentMessage=function(t){function recur(e){e.postMessage(t,"*"),e!==e.top&&recur(e.parent)}recur(this.window)},OverpassClient}(),Ae=createCommonjsModule(function(t,e){function _subscriberFromArgs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)throw Error("Cannot subscribe without listener");var n;if(t[0]instanceof r)n=t[0];else if(t[0]instanceof o){var i=t[0];n=new r(i.next.bind(i),i.throw.bind(i),i.complete.bind(i))}else if(t[0].onNext)n=r.fromListener(t[0]);else{var s=t[0],c=t[1]||function(t){throw t},a=t[2]||function(){};n=new r(s,c,a)}return n}function applyStreamMiddleware(t){var e=this,n=new o,r=n.subscribe;return n.subscribe=function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var s=_subscriberFromArgs.apply(void 0,o),c=t(s,e,n),a=c.completeFn;c.completeFn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a.apply(this,t),n.complete()};var u=e.subscribe(c),f=r.apply(n,[c]);return function(){f(),u()}},n}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){},r=function(){function Observer(t,e,r){void 0===e&&(e=n),void 0===r&&(r=n),this.nextFn=t,this.throwFn=e,this.completeFn=r}return Observer.fromListener=function(t){return new Observer(t.onNext,t.onError,t.onComplete)},Observer.prototype.next=function(t){this.nextFn&&this.nextFn(t)},Observer.prototype.throw=function(t){this.throwFn(t)},Observer.prototype.complete=function(){this.completeFn()},Observer}(),o=function(){function Stream(t){var e=this;this._hasEnded=!1,this._subscribers=[],t&&setTimeout(function(){e.next(t)})}return Stream.of=function(t){return Stream.create(function(e){e.nextComplete(t)})},Stream.create=function(t,e){var n=new Stream;if(t){var r=n.subscribe;n.subscribe=function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var s=r.apply(n,o);return setTimeout(function(){t(n)}),function(){e&&e(),s()}}}return n},Stream.timeout=function(t){if("number"!=typeof t)throw Error("Stream.interval(ms) argument must be a number");return Stream.create(function(e){setTimeout(function(){return e.complete()},t)})},Stream.interval=function(t,e){if("number"!=typeof t)throw Error("Stream.interval(ms) argument must be a number");var n,r;return Stream.create(function(o){if(!n){r=0;var i=function(){r++,o.next(r)};n=setInterval(i,t),e&&setTimeout(i)}},function(){return clearInterval(n)})},Stream.empty=function(){var t=new Stream;return setTimeout(function(){return t.complete()},0),t},Stream.fromPromise=function(t){var e,n=this;return t.catch(function(t){e=t}),Stream.create(function(r){return function __awaiter(t,e,n,r){return new(n||(n=Promise))(function(o,i){function step(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}},function rejected(t){try{step(r.throw(t))}catch(t){i(t)}})}step((r=r.apply(t,e||[])).next())})}(n,void 0,void 0,function(){var n,o,i;return function __generator(t,e){function verb(i){return function(c){return function step(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i}(this,function(s){switch(s.label){case 0:return e?(r.throw(e),[3,4]):[3,1];case 1:return s.trys.push([1,3,,4]),o=(n=r).next,[4,t];case 2:return o.apply(n,[s.sent()]),[3,4];case 3:return i=s.sent(),r.throw(i),[3,4];case 4:return r.complete(),[2]}})})})},Stream.fromList=function(t){return Stream.create(function(e){t.forEach(function(t){return e.next(t)}),e.complete()})},Stream.merge=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,o=e;r<o.length;r++){var i=o[r];t=Stream.mergeTwo(t,i)}return t},Stream.mergeTwo=function(t,e){return Stream.create(function(n){var r=0,o={onNext:function(t){return n.next(t)},onError:function(t){return n.throw(t)},onComplete:function(){++r>=2&&n.complete()}};t.subscribe(o),e.subscribe(o)})},Stream.prototype.toListFuture=function(){var t=this;return new Promise(function(e,n){var r=[],o={onNext:function(t){t&&r.push(t)},onError:function(t){n(t)},onComplete:function(){i(),e(r)}},i=t.subscribe(o)})},Stream.prototype.complete=function(){if(!this._hasEnded){this._hasEnded=!0;try{this._subscribers.forEach(function(t){return t.complete()})}catch(t){this.throw(t)}}},Stream.prototype.throw=function(t){if(!this._hasEnded)try{this._subscribers.forEach(function(e){return e.throw(t)})}catch(t){throw t}},Stream.prototype.next=function(t){if(!this._hasEnded)try{this._subscribers.forEach(function(e){return e.next(t)})}catch(t){this.throw(t)}},Stream.prototype.nextComplete=function(t){this.next(t),this.complete()},Stream.prototype.flatMap=function(t){return applyStreamMiddleware.call(this,function(e,n,o){return new r(function(n){t(n).subscribe({onNext:function(t){return e.next(t)},onError:function(t){return e.throw(t)}})},e.throw.bind(e))})},Stream.prototype.map=function(t){return applyStreamMiddleware.call(this,function(e,n,o){return new r(function(n){return e.next(t(n))},e.throw.bind(e),e.complete.bind(e))})},Stream.prototype.filter=function(t){return applyStreamMiddleware.call(this,function(e,n,o){return new r(function(n){return t(n)?e.next(n):null},e.throw.bind(e),e.complete.bind(e))})},Stream.prototype.distinctUntilChanged=function(){var t;return applyStreamMiddleware.call(this,function(e,n,o){return new r(function(n){t!==n&&e.next(n),t=n},e.throw.bind(e),e.complete.bind(e))})},Stream.prototype.take=function(t){var e=0;return applyStreamMiddleware.call(this,function(n,o,i){return new r(function(r){e++,i._hasEnded||n.next(r),e>=t&&i.complete()},n.throw.bind(n),n.complete.bind(n))})},Stream.prototype.scan=function(t,e){var n=0,o=e;return applyStreamMiddleware.call(this,function(e,i,s){return new r(function(r){o=t(o,r,n++),e.next(o)},e.throw.bind(e),e.complete.bind(e))})},Stream.prototype.zipWithIndex=function(){var t=0;return applyStreamMiddleware.call(this,function(e,n,o){return new r(function(n){e.next({_1:n,_2:t++})},e.throw.bind(e),e.complete.bind(e))})},Stream.prototype.do=function(t){return applyStreamMiddleware.call(this,function(e){return new r(function(n){return t(n),e.next(n)},e.throw.bind(e),e.complete.bind(e))})},Stream.prototype.subscribe=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=_subscriberFromArgs.apply(void 0,e);return this._subscribers.push(r),function(){return t._subscribers.splice(t._subscribers.indexOf(r),1)}},Stream}();e.Observer=r,e.Stream=o});!function unwrapExports(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(Ae);var Ie=Ae.Stream,Re=window,ze=function(){function OverpassServer(t){void 0===t&&(t=Re),this.window=t,this.connections=new Te,this.connections$=new Ie,this.instanceClientMap={},this.providers={},this.init()}return OverpassServer.prototype.onConnect=function(t){this.connections$.subscribe(t)},OverpassServer.prototype.use=function(t){this.providers[t.name]=t},OverpassServer.prototype.handleMessage=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,r,o;return __generator(this,function(i){switch(i.label){case 0:if(!(e=Le.deserialize(t.data)).isRequest)return[2];if(!this.providers[e.className])throw Error("No "+e.className+" is defined in OverpassServer.");this.instanceClientMap[e.uuid]=this.instanceClientMap[e.uuid]||{},this.instanceClientMap[e.uuid][e.className]=this.instanceClientMap[e.uuid][e.className]||new this.providers[e.className],n=this.instanceClientMap[e.uuid][e.className],i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n[e.method].apply(n,e.args)];case 2:return r=i.sent(),[3,4];case 3:return o=i.sent(),r=o,[3,4];case 4:return t.source.postMessage(Le.serialize(e.uuid,!1,e.className,e.method,r).join(":"),"*"),[2]}})})},OverpassServer.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,listenOnePostMessage(this.window,"passport:connection:request")];case 1:return t=e.sent(),[4,this.onConnectionRequest(t)];case 2:return e.sent(),[3,0];case 3:return[2]}})})},OverpassServer.prototype.onConnection=function(t,e){var n=this,r=new ke(t,e);this.connections.set(t,r),this.connections$.next(r),this.window.addEventListener("message",function(t){t.data&&t.data.indexOf&&t.data.indexOf("Overpass")>-1&&n.connections.forEach(function(e){e.is(t.source)&&n.handleMessage(t)})})},OverpassServer.prototype.onConnectionRequest=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,r;return __generator(this,function(o){switch(o.label){case 0:return e=""+Ce()+Ce()+"-"+Ce()+"-"+Ce()+"-"+Ce()+"-"+Ce()+Ce()+Ce(),n="passport:connection:response:"+e,t.source.postMessage(n,"*"),[4,listenOnePostMessage(this.window,n)];case 1:return r=o.sent().source,t.source.postMessage("registered:"+e,"*"),this.onConnection(e,r),[2]}})})},OverpassServer}();window.Proxy||(window.Proxy=e),t.OverpassClient=Fe,t.OverpassServer=ze,t.OverpassConnection=ke,Object.defineProperty(t,"__esModule",{value:!0})});
