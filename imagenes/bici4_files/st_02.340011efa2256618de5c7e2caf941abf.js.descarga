!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof noAMDDefine&&noAMDDefine.amd?noAMDDefine(["exports"],t):t(e.Vast={})}(this,function(e){"use strict";function loadAd(e,n,o){return void 0===o&&(o={}),new Promise(function(i,r){t().then(function(){return function loadAdWithIMASDK(e,t,n){void 0===n&&(n={});var o=t.ownerDocument.createElement("video");o.muted=!0,o.setAttribute("muted","true"),o.setAttribute("playsinline","true"),o.setAttribute("WebkitPlaysinline","true");var i=navigator.userAgent||navigator.vendor,r=/iPad|iPhone|iPod/.test(i)&&!window.MSStream||/android/i.test(i);return new Promise(function(i,a){var s;r&&((s=document.createElement("div")).style.position="absolute",s.style.zIndex="10",s.style.top="0",s.style.left="0",s.style.display="none",s.style.width="100%",s.style.height="100%",s.style.cursor="pointer",t.appendChild(s));var d=new google.ima.AdDisplayContainer(t,o,s);d.initialize();var l=new google.ima.AdsLoader(d);l.getSettings().setVpaidMode(n.vpaidMode||google.ima.ImaSdkSettings.VpaidMode.INSECURE),l.getSettings().setDisableCustomPlaybackForIOS10Plus(n.disableCustomPlaybackForIOS10Plus||!0);var c=new google.ima.AdsRenderingSettings;c.uiElements=[];l.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(e){var n=e.getAdsManager(o,c);n.addEventListener(google.ima.AdEvent.Type.IMPRESSION,function(e){e.getAd();o.parentNode||(t.firstChild?t.insertBefore(o,t.firstChild):t.appendChild(o),o.style.width="100%",o.style.height="100%",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.backgroundColor="black",n.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(e){o&&o.parentNode&&o.parentNode.removeChild&&o.parentNode.removeChild(o)}))});var r=function(e){s&&-1===String(e.getAd().getApiFramework()).toLocaleLowerCase().indexOf("vpaid")&&(s.style.display=e.type===google.ima.AdEvent.Type.PAUSED?"none":"block")};n.addEventListener(google.ima.AdEvent.Type.STARTED,r),n.addEventListener(google.ima.AdEvent.Type.PAUSED,r),n.addEventListener(google.ima.AdEvent.Type.RESUMED,r),i(n)},!1),l.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,a,!1);var u=new google.ima.AdsRequest;0!==e.trim().indexOf("http")&&-1!==e.indexOf("<VAST")?u.adsResponse=e:u.adTagUrl=e,l.requestAds(u)})}(e,n,o).then(i).catch(r)})})}function addClass(e,t){hasClass(e,t)||(e.className+=" "+t,e.className=e.className.trim())}function removeClass(e,t){if(hasClass(e,t)){var n=e.className.split(" ");n.splice(n.indexOf(t),1),e.className=n.join(" ").trim()}}function hasClass(e,t){return-1!==e.className.split(" ").indexOf(t)}function __awaiter$1(e,t,n,o){return new(n||(n=Promise))(function(i,r){function step(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(function fulfilled(e){try{step(o.next(e))}catch(e){r(e)}},function rejected(e){try{step(o.throw(e))}catch(e){r(e)}})}step((o=o.apply(e,t||[])).next())})}function __generator(e,t){function verb(r){return function(s){return function step(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=o[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r}var t=function memoize(e){var t;return function(){return t||(t=e()),t}}(function(){return new Promise(function(e,t){var n=document.createElement("script");n.addEventListener("load",e),n.addEventListener("error",function(e){t(e)}),n.src="//imasdk.googleapis.com/js/sdkloader/ima3.js";var o=document.getElementsByTagName("script")[0];o&&o.parentNode?o.parentNode.insertBefore(n,o):document.body.appendChild(n)})}),n=function(){function XMLHelper(){}return XMLHelper.getXMLDoc=function(e){var t;if(XMLHelper.supportActiveX){try{t=new ActiveXObject("Msxml2.DOMDocument.6.0")}catch(e){try{t=new ActiveXObject("Msxml2.DOMDocument.3.0")}catch(e){t=new ActiveXObject("Microsoft.XMLDOM")}}t.async=!1,t.loadXML(e)}else{if(!DOMParser)throw new Error("Connot parse XML, ActiveXObject or DOMParser not available");var n=new DOMParser;t=n.parseFromString(e,"text/xml")}return t},XMLHelper.getNodeContent=function(e){if(e)try{var t=XMLHelper.getFirstChild(e);return t?XMLHelper.getNodeTextContent(t):""}catch(e){}},XMLHelper.getAttributeValue=function(e,t){try{if(e.attributes[t])return String(e.attributes[t].value)}catch(e){}},XMLHelper.isAllWhitespace=function(e){return!/[^\t\n\r ]/.test(e.textContent?e.textContent:e.text)},XMLHelper.isIgnorable=function(e){return 8===e.nodeType||3===e.nodeType&&XMLHelper.isAllWhitespace(e)},XMLHelper.getFirstChild=function(e){for(var t=e.firstChild;t;){if(!XMLHelper.isIgnorable(t))return t;t=t.nextSibling}return null},XMLHelper.getNodeTextContent=function(e){var t=(e.textContent?e.textContent:e.text).replace(/[\t\n\r ]+/g," ");return" "===t.charAt(0)&&(t=t.substring(1,t.length))," "===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t},XMLHelper.supportActiveX=Object&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window||!!window.ActiveXObject,XMLHelper}(),o="<!doctype html>\n<html>\n  <head>\n    <style>\n      body {\n        padding: 0;\n        margin:0;\n      }\n      #mute-button {\n        position: absolute;\n        top: 0px;\n        left: 0px;\n        width: 18px;\n        height: 18px;\n        z-index:99999;\n        cursor: pointer;\n        padding: 17px;\n        display:none;\n      }\n\n      #main-container.with-controls #mute-button {\n        display:block;\n      }\n\n      #mute-button svg {\n        fill:#fff;\n        width: 18px;\n        height: 18px;\n      }\n\n      #mute-button svg.muted {\n        display:none;\n      }\n\n      #mute-button svg.not-muted {\n        display:block;\n      }\n\n      #mute-button.muted svg.muted {\n        display:block;\n      }\n\n      #mute-button.muted svg.not-muted {\n        display:none;\n      }\n\n      #close-button {\n        width: 36px;\n        height: 36px;\n        background-color: rgba(0,0,0, .5);\n        font-family: 'Roboto', sans-serif;\n        font-size: 12px;\n        color: #FFF;\n        opacity: .8;\n        cursor: pointer;\n        z-index: 900;\n        position: absolute;\n        top: 10px;\n        right:10px;\n        display:none;\n      }\n\n      #main-container.with-controls #close-button {\n        display: block;\n      }\n\n      #close-button #loader {\n        width: 28px;\n        height: 28px;\n        left: 0;\n        margin: 4px;\n        position: absolute;\n        cursor: pointer;\n        top: 0;\n      }\n      \n      /** replace button position for mobile and small screen **/\n      @media all and (max-width: 360px) {\n        #mute-button {\n          padding: 10px;\n        }\n\n        #close-button {\n          top: 4px;\n          right: 4px;\n        }\n      }\n\n      #main-container {\n        height: 100%;\n        width: 100%;\n        overflow: hidden;\n        position: absolute;\n        bottom:0px;\n        left: 0px;\n      }\n\n      #main-container.with-controls {\n        background-color: black;\n        transition-property: height;\n        transition-duration: 0.5s; /** close duration **/\n        transition-delay: 0s;\n        height: 0%;\n      }\n\n      #main-container.with-controls.show {\n        transition-duration: 0s;  /**open duration **//** Disabled for test to see if it have an impact on viewability **/\n        height: 100%;\n      }\n\n      /** PREVENT VIDEO TO BE DISPLAYED IN BACKGROUND IN IIV/FIV (they use their own video file) **/\n      #main-container #ad-container video {\n        display: none\n      }\n      #main-container.with-controls #ad-container video {\n        display: block\n      }\n\n    </style>\n  </head>\n  <body>\n    <div id=\"main-container\" class=\"container with-controls\">\n        <div id=\"mute-button\" class=\"muted\">\n          <svg class=\"muted\" xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'>\n            <path d=\"M3 9v6h-1v-6h1zm13-7l-9 5v2.288l7-3.889v13.202l-7-3.889v2.288l9 5v-20zm-11 5h-5v10h5v-10zm17.324 4.993l1.646-1.659-1.324-1.324-1.651 1.67-1.665-1.648-1.316 1.318 1.67 1.657-1.65 1.669 1.318 1.317 1.658-1.672 1.666 1.653 1.324-1.325-1.676-1.656z\" />\n          </svg>\n          <svg class=\"not-muted\" xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'>\n            <path d=\"M3 9v6h-1v-6h1zm13-7l-9 5v2.288l7-3.889v13.202l-7-3.889v2.288l9 5v-20zm-11 5h-5v10h5v-10zm13.008 2.093c.742.743 1.2 1.77 1.198 2.903-.002 1.133-.462 2.158-1.205 2.9l1.219 1.223c1.057-1.053 1.712-2.511 1.715-4.121.002-1.611-.648-3.068-1.702-4.125l-1.225 1.22zm2.142-2.135c1.288 1.292 2.082 3.073 2.079 5.041s-.804 3.75-2.096 5.039l1.25 1.254c1.612-1.608 2.613-3.834 2.616-6.291.005-2.457-.986-4.681-2.595-6.293l-1.254 1.25z\" />\n          </svg>\n        </div>\n        <div id=\"close-button\">\n          <div class='skip_text' style='display: none'>Skip Ad</div>\n          <div id='loader'>\n            <svg viewBox='0 0 100 100' style='display: block; width: 100%;'>\n              <path d='M 50,50 m 0,-47 a 47,47 0 1 1 0,94 a 47,47 0 1 1 0,-94' stroke='#000' stroke-width='6' fill-opacity='0'>\n              </path>\n              <path d='M 50,50 m 0,-47 a 47,47 0 1 1 0,94 a 47,47 0 1 1 0,-94' stroke='#fff' stroke-width='6' fill-opacity='0' style='stroke-dasharray: 295.416, 295.416; stroke-dashoffset: 0;'>\n              </path>\n            </svg>\n            <div class='progressbar-text'\n                  style='position: absolute; left: 50%; top: 50%; padding: 0px; margin: 0px; transform: translate(-50%, -50%); color: rgb(255, 255, 255);'>\n              X\n            </div>\n          </div>\n        </div>\n        <div id=\"ad-container\"></div>\n    </div>\n  </body>\n</html>",i=function(){function VideoCreative(e){var t=this;this.container=e,this.iframe=function createIframe(e){void 0===e&&(e={});var t=document.createElement("iframe");return t.style.margin="0px",t.style.padding="0px",t.style.width="100%",t.style.height="100%",t.style.border="0px",t.style.overflow="hidden",t.setAttribute("scrolling","no"),t.frameBorder="0",Object.keys(e).forEach(function(n){t.style[n]=e[n]}),t}(),e.appendChild(this.iframe),this.iframe.contentWindow.document.write(o),this.iframe.contentWindow.document.close(),this.iframe.contentWindow.addEventListener("message",function(e){"remove_controls"===e.data&&removeClass(t.iframe.contentWindow.document.getElementById("main-container"),"with-controls")})}return VideoCreative.prototype.loadAd=function(e){var t=this;return loadAd(e,this.iframe.contentWindow.document.getElementById("ad-container")).then(function(e){return e.addEventListener(google.ima.AdEvent.Type.IMPRESSION,function(){var n=t.iframe.contentWindow.document.getElementById("mute-button"),o=t.iframe.contentWindow.document.getElementById("close-button"),i=t.iframe.contentWindow.document.getElementById("main-container");o.addEventListener("click",function(){return e.stop()}),n.addEventListener("click",function(){return e.setVolume(e.getVolume()?0:1)}),e.addEventListener(google.ima.AdEvent.Type.VOLUME_CHANGED,function(){e.getVolume()?removeClass(n,"muted"):addClass(n,"muted")}),e.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(){removeClass(i,"show")}),setTimeout(function(){return addClass(i,"show")})}),e})},VideoCreative.prototype.destroy=function(){this.iframe.contentWindow.document.removeChild(this.iframe.contentWindow.document.documentElement),this.container.removeChild(this.iframe)},VideoCreative}(),r=function(){function VideoPlayerController(e,t){this.videoEventsHandler=e,this.adSlot=t,this.loaded=!1,this.videoCreative=new i(t),this.videoEventsHandler.onReady()}return VideoPlayerController.prototype.destroy=function(){this.adsManager&&this.adsManager.destroy(),this.videoCreative.destroy()},VideoPlayerController.prototype.play=function(){return __awaiter$1(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){e.loaded||n(new Error("Cannot play the vast before loading it")),e.bindManagerEvents((o={},o[google.ima.AdEvent.Type.IMPRESSION]=function(){t(!0),e.videoEventsHandler.onPlay(),e.adsManager.resize(e.adSlot.offsetWidth,e.adSlot.offsetHeight,google.ima.ViewMode.NORMAL)},o[google.ima.AdEvent.Type.FIRST_QUARTILE]=e.videoEventsHandler.onFirstQuartile,o[google.ima.AdEvent.Type.MIDPOINT]=e.videoEventsHandler.onMidPoint,o[google.ima.AdEvent.Type.SKIPPED]=e.videoEventsHandler.onSkip,o[google.ima.AdEvent.Type.THIRD_QUARTILE]=e.videoEventsHandler.onThirdQuartile,o[google.ima.AdEvent.Type.COMPLETE]=function(){return e.videoEventsHandler.onComplete},o[google.ima.AdEvent.Type.ALL_ADS_COMPLETED]=e.videoEventsHandler.onAllAdsComplete,o[google.ima.AdErrorEvent.Type.AD_ERROR]=function(t){e.videoEventsHandler.onError({errorCode:t.getError().getErrorCode(),errorType:t.getError().getType()})},o)),e.adsManager.start();var o}).catch(function(){return Promise.reject(new Error("adPlayError"))})]})})},VideoPlayerController.prototype.hasAd=function(e){return __awaiter$1(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){return this.adsManager&&this.adsManager.destroy(),this.loaded=!1,[2,new Promise(function(n,o){return __awaiter$1(t,void 0,void 0,function(){var t,i,r,a=this;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),t=this,[4,this.videoCreative.loadAd(e)];case 1:return t.adsManager=s.sent(),[3,3];case 2:return i=s.sent(),[2,o(i)];case 3:return this.bindManagerEvents((r={},r[google.ima.AdEvent.Type.LOADED]=function(){n(!0),a.videoEventsHandler.onLoaded(),a.loaded=!0},r[google.ima.AdErrorEvent.Type.AD_ERROR]=o,r)),this.adsManager.init(this.adSlot.offsetWidth,this.adSlot.offsetHeight,google.ima.ViewMode.NORMAL),[2]}})})}).catch(function(){return Promise.reject(new Error("adLoadError"))})]})})},VideoPlayerController.prototype.bindManagerEvents=function(e){var t=this;for(var n in e)!function(n){e.hasOwnProperty(n)&&t.adsManager.addEventListener(n,function(){return e[n]()})}(n)},VideoPlayerController}();e.loadAd=loadAd,e.XMLHelper=n,e.VideoCreative=i,e.VideoPlayerController=r,Object.defineProperty(e,"__esModule",{value:!0})});
