!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof noAMDDefine&&noAMDDefine.amd?noAMDDefine(["exports"],e):e(t.Stream={})}(this,function(t){"use strict";function _subscriberFromArgs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)throw Error("Cannot subscribe without listener");var o;if(t[0]instanceof r)o=t[0];else if(t[0]instanceof n){var i=t[0];o=new r(i.next.bind(i),i.throw.bind(i),i.complete.bind(i))}else if(t[0].onNext)o=r.fromListener(t[0]);else{var u=t[0],c=t[1]||function(t){throw t},a=t[2]||function(){};o=new r(u,c,a)}return o}function applyStreamMiddleware(t){var e=this,r=new n,o=r.subscribe;return r.subscribe=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var u=_subscriberFromArgs.apply(void 0,n),c=t(u,e,r),a=c.completeFn;c.completeFn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a.apply(this,t),r.complete()};var s=e.subscribe(c),f=o.apply(r,[c]);return function(){f(),s()}},r}var e=function(){},r=function(){function Observer(t,r,n){void 0===r&&(r=e),void 0===n&&(n=e),this.nextFn=t,this.throwFn=r,this.completeFn=n}return Observer.fromListener=function(t){return new Observer(t.onNext,t.onError,t.onComplete)},Observer.prototype.next=function(t){this.nextFn&&this.nextFn(t)},Observer.prototype.throw=function(t){this.throwFn(t)},Observer.prototype.complete=function(){this.completeFn()},Observer}(),n=function(){function Stream(t){var e=this;this._hasEnded=!1,this._subscribers=[],t&&setTimeout(function(){e.next(t)})}return Stream.of=function(t){return Stream.create(function(e){e.nextComplete(t)})},Stream.create=function(t,e){var r=new Stream;if(t){var n=r.subscribe;r.subscribe=function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var u=n.apply(r,o);return setTimeout(function(){t(r)}),function(){e&&e(),u()}}}return r},Stream.timeout=function(t){if("number"!=typeof t)throw Error("Stream.interval(ms) argument must be a number");return Stream.create(function(e){setTimeout(function(){return e.complete()},t)})},Stream.interval=function(t,e){if("number"!=typeof t)throw Error("Stream.interval(ms) argument must be a number");var r,n;return Stream.create(function(o){if(!r){n=0;var i=function(){n++,o.next(n)};r=setInterval(i,t),e&&setTimeout(i)}},function(){return clearInterval(r)})},Stream.empty=function(){var t=new Stream;return setTimeout(function(){return t.complete()},0),t},Stream.fromPromise=function(t){var e,r=this;return t.catch(function(t){e=t}),Stream.create(function(n){return function __awaiter(t,e,r,n){return new(r||(r=Promise))(function(o,i){function step(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(function fulfilled(t){try{step(n.next(t))}catch(t){i(t)}},function rejected(t){try{step(n.throw(t))}catch(t){i(t)}})}step((n=n.apply(t,e||[])).next())})}(r,void 0,void 0,function(){var r,o,i;return function __generator(t,e){function verb(i){return function(c){return function step(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(o=u.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i}(this,function(u){switch(u.label){case 0:return e?(n.throw(e),[3,4]):[3,1];case 1:return u.trys.push([1,3,,4]),o=(r=n).next,[4,t];case 2:return o.apply(r,[u.sent()]),[3,4];case 3:return i=u.sent(),n.throw(i),[3,4];case 4:return n.complete(),[2]}})})})},Stream.fromList=function(t){return Stream.create(function(e){t.forEach(function(t){return e.next(t)}),e.complete()})},Stream.merge=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var n=0,o=e;n<o.length;n++){var i=o[n];t=Stream.mergeTwo(t,i)}return t},Stream.mergeTwo=function(t,e){return Stream.create(function(r){var n=0,o={onNext:function(t){return r.next(t)},onError:function(t){return r.throw(t)},onComplete:function(){++n>=2&&r.complete()}};t.subscribe(o),e.subscribe(o)})},Stream.prototype.toListFuture=function(){var t=this;return new Promise(function(e,r){var n=[],o={onNext:function(t){t&&n.push(t)},onError:function(t){r(t)},onComplete:function(){i(),e(n)}},i=t.subscribe(o)})},Stream.prototype.complete=function(){if(!this._hasEnded){this._hasEnded=!0;try{this._subscribers.forEach(function(t){return t.complete()})}catch(t){this.throw(t)}}},Stream.prototype.throw=function(t){if(!this._hasEnded)try{this._subscribers.forEach(function(e){return e.throw(t)})}catch(t){throw t}},Stream.prototype.next=function(t){if(!this._hasEnded)try{this._subscribers.forEach(function(e){return e.next(t)})}catch(t){this.throw(t)}},Stream.prototype.nextComplete=function(t){this.next(t),this.complete()},Stream.prototype.flatMap=function(t){return applyStreamMiddleware.call(this,function(e,n,o){return new r(function(r){t(r).subscribe({onNext:function(t){return e.next(t)},onError:function(t){return e.throw(t)}})},e.throw.bind(e))})},Stream.prototype.map=function(t){return applyStreamMiddleware.call(this,function(e,n,o){return new r(function(r){return e.next(t(r))},e.throw.bind(e),e.complete.bind(e))})},Stream.prototype.filter=function(t){return applyStreamMiddleware.call(this,function(e,n,o){return new r(function(r){return t(r)?e.next(r):null},e.throw.bind(e),e.complete.bind(e))})},Stream.prototype.distinctUntilChanged=function(){var t;return applyStreamMiddleware.call(this,function(e,n,o){return new r(function(r){t!==r&&e.next(r),t=r},e.throw.bind(e),e.complete.bind(e))})},Stream.prototype.take=function(t){var e=0;return applyStreamMiddleware.call(this,function(n,o,i){return new r(function(r){e++,i._hasEnded||n.next(r),e>=t&&i.complete()},n.throw.bind(n),n.complete.bind(n))})},Stream.prototype.scan=function(t,e){var n=0,o=e;return applyStreamMiddleware.call(this,function(e,i,u){return new r(function(r){o=t(o,r,n++),e.next(o)},e.throw.bind(e),e.complete.bind(e))})},Stream.prototype.zipWithIndex=function(){var t=0;return applyStreamMiddleware.call(this,function(e,n,o){return new r(function(r){e.next({_1:r,_2:t++})},e.throw.bind(e),e.complete.bind(e))})},Stream.prototype.do=function(t){return applyStreamMiddleware.call(this,function(e){return new r(function(r){return t(r),e.next(r)},e.throw.bind(e),e.complete.bind(e))})},Stream.prototype.subscribe=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=_subscriberFromArgs.apply(void 0,e);return this._subscribers.push(n),function(){return t._subscribers.splice(t._subscribers.indexOf(n),1)}},Stream}();t.Observer=r,t.Stream=n,Object.defineProperty(t,"__esModule",{value:!0})});
